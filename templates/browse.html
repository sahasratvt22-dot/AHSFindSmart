{% extends "base.html" %}
{% block content %}

<section class="page-head friendly-head">
  <div class="container">
    <h1>Browse Found Items</h1>
    <p class="muted">Search and filter approved items. Use “Claim” to request an item.</p>
  </div>
</section>

<section class="container">
  <form class="filters" method="GET" action="{{ url_for('browse') }}" aria-label="Search and filters">
    <div class="field">
      <label for="q">Search</label>
      <input id="q" name="q" value="{{ q }}" placeholder="Search title, description, location..." />
    </div>

    <div class="field">
      <label for="category">Category</label>
      <select id="category" name="category">
        <option value="">All</option>
        {% for c in categories %}
          <option value="{{ c.category }}" {% if category == c.category %}selected{% endif %}>
            {{ c.category }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="field actions">
      <button class="btn" type="submit">Apply</button>
      <a class="btn btn-outline" href="{{ url_for('browse') }}">Clear</a>
    </div>
  </form>

  <div class="grid browse-grid">
    {% if items|length == 0 %}
      <div class="empty">
        <h2>No items found.</h2>
        <p class="muted">Try different keywords or filters.</p>
      </div>
    {% endif %}

    {% for item in items %}
      <article class="card item-card">
        <div class="card-top">
          <span class="chip">{{ item.category }}</span>
          {% if item.photo_filename %}
            <img
              class="card-img"
              src="{{ url_for('uploaded_file', filename=item.photo_filename) }}"
              alt="Photo of {{ item.title }}"
            />
          {% else %}
            <div class="card-img placeholder" aria-label="No photo provided">No Photo</div>
          {% endif %}
        </div>

        <div class="card-body">
          <div class="card-title-row">
            <h2 class="card-title">{{ item.title }}</h2>
            <span class="badge badge-{{ item.status }}">{{ item.status }}</span>
          </div>
          <p class="card-desc muted">{{ item.description|truncate(110, True, '...') }}</p>

          <div class="card-meta">
            <div>
              <span class="meta-label">Found at</span>
              <span class="meta-value">{{ item.location_found }}</span>
            </div>
            <div>
              <span class="meta-label">Date</span>
              <span class="meta-value">{{ item.date_found }}</span>
            </div>
          </div>

          <div class="card-actions">
            <button
              class="btn btn-block js-item-details"
              type="button"
              data-title="{{ item.title|e }}"
              data-description="{{ item.description|e }}"
              data-location="{{ item.location_found|e }}"
              data-date="{{ item.date_found|e }}"
              data-category="{{ item.category|e }}"
              data-status="{{ item.status|e }}"
              data-claim-url="{{ url_for('claim_item', item_id=item.id) }}"
              data-image="{% if item.photo_filename %}{{ url_for('uploaded_file', filename=item.photo_filename) }}{% endif %}"
            >
              View Details
            </button>
          </div>
        </div>
      </article>
    {% endfor %}
  </div>
</section>

<div class="modal item-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="itemModalTitle">
  <div class="modal-card">
    <button class="modal-close" type="button" aria-label="Close details">x</button>

    <div class="item-modal-media">
      <img class="item-modal-img" alt="" />
      <div class="item-modal-placeholder">No Photo</div>
      <div class="item-modal-chip" data-modal-status></div>
    </div>

    <div class="item-modal-body">
      <div class="item-modal-title-row">
        <h2 id="itemModalTitle"></h2>
      </div>

      <p class="item-modal-desc" data-modal-description></p>

      <div class="item-modal-meta">
        <div class="meta-card">
          <span class="meta-label">Category</span>
          <span class="meta-value" data-modal-category></span>
        </div>
        <div class="meta-card">
          <span class="meta-label">Found at</span>
          <span class="meta-value" data-modal-location></span>
        </div>
        <div class="meta-card">
          <span class="meta-label">Date</span>
          <span class="meta-value" data-modal-date></span>
        </div>
      </div>

      <a class="btn btn-block item-modal-cta" data-modal-claim href="#">Claim This Item</a>
      <p class="tiny muted item-modal-note">Provide proof of ownership to claim this item.</p>
    </div>
  </div>
</div>

{% endblock %}
